<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<body style="margin: 0px">

<div id="checker">
</div>

<div id="map" style="z-index: 1; position: absolute">

</div>

<image id="layer" style="z-index: 2; position: absolute;">

</image>


<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD8WU_Hc5l507bZVpdCKDEmZDjhjOFHXHs&callback=initMap"></script>
<script type="text/javascript">

  function initMap () {
    const queryString = window.location.search
    const urlParams = new URLSearchParams(queryString)

    const level = parseInt(urlParams.get('level'))
    const lat = parseFloat(urlParams.get('lat'))
    const lng = parseFloat(urlParams.get('lng'))
    const type = urlParams.get('type')
    const noLabel = urlParams.get('noLabel') === 'true'

    let goalWidth
    let zoomLevel
    let maptype
    let defaultWidth = 500
    let dynamicWidth = defaultWidth

    var noLabelStyle = [
      {
        'elementType': 'labels',
        'stylers': [
          {
            'visibility': 'off'
          }
        ]
      },
      {
        'featureType': 'administrative.neighborhood',
        'stylers': [
          {
            'visibility': 'off'
          }
        ]
      }
    ]

    if (type === 'basic') {
      maptype = google.maps.MapTypeId.ROADMAP
    } else if (type === 'satellite_base') {
      maptype = google.maps.MapTypeId.SATELLITE
    } else if (type === 'satellite') {
      maptype = google.maps.MapTypeId.HYBRID
    }

    switch (level) {
      case 1:
        zoomLevel = 18
        goalWidth = 5000
        break
      case 2:
        zoomLevel = 17
        goalWidth = 4000
        break
      case 5:
        zoomLevel = 16
        goalWidth = 5000
        break
      case 10:
        zoomLevel = 15
        goalWidth = 5000
        break
      default:
        break
    }

    let container = document.getElementById('map')
    let options = {
      center: {
        lat: lat,
        lng: lng
      },
      zoom: zoomLevel,
      mapTypeId: maptype,
      disableDefaultUI: true,
      gestureHandling: 'none',
      keyboardShortcuts: false,
      tilt: 0
    }

    let map = new google.maps.Map(container, options)

    if (noLabel) {
      map.set('styles', noLabelStyle)
    }

    let intervalCount = 0

    let timerId = setInterval(function () {

      intervalCount++
      map.setCenter(new google.maps.LatLng(lat, lng))

      if (dynamicWidth <= goalWidth) {
        container.style.height = dynamicWidth + 'px'
        container.style.width = dynamicWidth + 'px'

        dynamicWidth += defaultWidth

      } else if (dynamicWidth > goalWidth) {
        dynamicWidth = goalWidth

        document.getElementById('checker').setAttribute('id', 'checker_true')
        document.getElementById('checker_true').setAttribute('neLat', map.getBounds().getNorthEast().lat())
        document.getElementById('checker_true').setAttribute('neLng', map.getBounds().getNorthEast().lng())
        document.getElementById('checker_true').setAttribute('swLat', map.getBounds().getSouthWest().lat())
        document.getElementById('checker_true').setAttribute('swLng', map.getBounds().getSouthWest().lng())

        document.getElementById('layer').style.height = goalWidth + 'px'
        document.getElementById('layer').style.width = goalWidth + 'px'
        clearInterval(timerId)

      }

      if (intervalCount >= 30) {
        document.getElementById('checker').setAttribute('id', 'checker_true')
        clearInterval(timerId)
      }

    }, 1000)

  }


</script>
</body>
</html>
